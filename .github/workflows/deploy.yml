name: Deploy

on:
  push: # Remove this for the one below once it works
    branches:
        - "**"
  # workflow_run:
  #   workflows: ["Scala CI"]
  #   types:
  #     - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    # UNCOMMENT THIS
#    if: github.event.workflow_run.conclusion == 'success' && github.ref == 'refs/heads/master'
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: assembly
      run: |
        sed -i 's!\"\.\./botDB\.sqlite3"!\"botDB\.sqlite3\"!g' /home/runner/work/sBots/sBots/main/src/main/resources/application.conf
        cat /home/runner/work/sBots/sBots/main/src/main/resources/application.conf
        sbt "assembly"
    - name: Create SSH key
      run: |
        install -m 600 -D /dev/null ~/.ssh/id_rsa
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
    - name: test connection
      run: |
        rsync -av -e 'ssh -o StrictHostKeyChecking=no' /home/runner/work/sBots/sBots/main/target/scala-2.13/main.jar ubuntu@${{ secrets.DEPLOY_SERVER_IP }}:/home/ubuntu/bots/test.jar
